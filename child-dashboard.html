<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Tasks - TaskQuest</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="child-body">
    <nav class="navbar child-nav">
        <div class="nav-brand">
            <span class="logo-icon">‚≠ê</span>
            <span>TaskQuest</span>
        </div>

        <!-- Center nav links (visible on desktop/tablet) -->
        <div class="nav-links">
            <a href="#tasks" class="nav-link active" onclick="navigateToSection('tasks'); return false;">Tasks</a>
            <a href="#rewards" class="nav-link" onclick="navigateToSection('rewards'); return false;">Rewards</a>
            <a href="#profile" class="nav-link" onclick="navigateToSection('profile'); return false;">Profile</a>
        </div>

        <!-- Profile avatar + dropdown -->
        <div class="profile-dropdown" id="profileDropdown">
            <button class="profile-btn" id="profileBtn" aria-haspopup="true" aria-expanded="false">
                <span class="profile-initial">üë§</span>
            </button>
            <div class="profile-menu" id="profileMenu" role="menu" aria-hidden="true">
                <!-- Mobile-only links: duplicate of nav links for small screens -->
                <a class="profile-menu-item mobile-only" href="#tasks" onclick="toggleProfileMenu(false); navigateToSection('tasks'); return false;">Tasks</a>
                <a class="profile-menu-item mobile-only" href="#rewards" onclick="toggleProfileMenu(false); navigateToSection('rewards'); return false;">Rewards</a>
                <a class="profile-menu-item" href="#profile" onclick="toggleProfileMenu(false); navigateToSection('profile'); return false;">Profile</a>
                    <button class="profile-menu-item" onclick="toggleProfileMenu(false); logout();">Logout</button>
            </div>
        </div>
    </nav>

    <main class="child-dashboard-container">
        <!-- Points Hero Card -->
        <div class="points-hero-section">
            <div class="points-card">
                <div class="points-icon">‚≠ê</div>
                <div class="points-content">
                    <div class="points-label">Your Points</div>
                    <div class="points-value" id="points-value">0</div>
                </div>
            </div>
            <p class="points-subtitle">Complete tasks to earn rewards!</p>
        </div>

        <!-- Available Tasks Section -->
        <section id="tasks-section" class="child-section">
            <div class="section-header">
                <h2 class="section-title">üìã Available Tasks</h2>
            </div>
            <div class="child-tasks-grid" id="childTasksGrid">
                <p>Loading tasks...</p>
            </div>
        </section>

        <!-- Rewards Store Section -->
        <section id="rewards-section" class="child-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">üéÅ Rewards Store</h2>
            </div>
            <div class="rewards-store-grid" id="rewardsStoreGrid">
                <p>Loading rewards...</p>
            </div>
        </section>

        <!-- Profile & Activity Section -->
        <section id="profile-section" class="child-section" style="display: none;">
            <div class="profile-wrapper">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar">üë§</div>
                        <div class="profile-info">
                            <h3 id="profileName">Loading...</h3>
                            <p id="profileEmail">Loading...</p>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="profile-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="totalPoints">0</div>
                            <div class="stat-label">Total Points</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="completedTasks">0</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="rewardsRedeemed">0</div>
                            <div class="stat-label">Rewards</div>
                        </div>
                    </div>

                    <!-- Family Link Section -->
                    <div class="family-section">
                        <h4>üë®‚Äçüë©‚Äçüëß Family Connection</h4>
                        <p id="linkedParentInfo">Not linked to a family yet.</p>
                        <div class="family-code-input-row">
                            <input type="text" id="childFamilyCodeInput" placeholder="Enter 6-digit family code">
                            <button class="primary-btn" onclick="setFamilyCodeForChild()">Link</button>
                        </div>
                    </div>
                </div>

                <!-- Activity History -->
                <div class="activity-section">
                    <h3 class="section-title">üìà Activity History</h3>
                    <div class="activity-list" id="activityList">
                        <p>Loading activity history...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Upload Task Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUploadModal()">&times;</span>
            <h2>üì∏ Complete Task</h2>
            <p class="modal-subtitle" id="uploadTaskTitle">Take your before & after photos</p>
            <div class="upload-section">
                <div class="upload-step">
                    <h3>Step 1: Before Photo</h3>
                    <div class="upload-box" id="beforeUploadBox">
                        <input type="file" id="beforePhoto" accept="image/*" onchange="uploadBeforePhoto(event)">
                        <label for="beforePhoto" class="upload-label">
                            <div class="upload-icon">üì∏</div>
                            <div class="upload-text">Click to upload BEFORE photo</div>
                        </label>
                        <div id="beforePreview" class="preview-box"></div>
                    </div>
                </div>

                <div class="upload-step">
                    <h3>Step 2: After Photo</h3>
                    <div class="upload-box" id="afterUploadBox">
                        <input type="file" id="afterPhoto" accept="image/*" onchange="uploadAfterPhoto(event)">
                        <label for="afterPhoto" class="upload-label">
                            <div class="upload-icon">üì∏</div>
                            <div class="upload-text">Click to upload AFTER photo</div>
                        </label>
                        <div id="afterPreview" class="preview-box"></div>
                    </div>
                </div>
            </div>

            <button class="submit-btn" onclick="submitTaskForReview()">‚úÖ Submit for Review</button>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification"></div>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <script src="scripts/main.js?v=2025-12-01-fix-b27"></script>
</body>
</html>